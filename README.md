# spss_exploration_project

[Badges]
- [Project Title & Overview](#project-title--overview)
- [Repository Content](#repository-content)
- [Pre-requisites](#pre-requisites)
- [Installation](#installation)
- [Usage](#usage)
- [Input Formats](#input-formats)
- [Output](#output)
- [Reproducing Results](#reproducing-results)
- [Contributions](#contributions)


## Project Title & Overview

The **spss_exploration_project** aims to represent and index a DNA sequencing file to quickly compare query sequences with this set of sequences. The comparison is performed without alignment and consists of counting the number of shared *k*-mers between the query sequence and the sequences in the sequencing file.

To optimize indexing and searching, the project uses a **SPSS (Solid Prefix Sequence Set)**. The SPSS is an optimized data structure that groups continuous sequences (simplitigs or unitigs) derived from solid *k*-mers extracted from genomic sequences. This approach reduces redundancy and improves indexing efficiency by minimizing data size while retaining essential information for queries.

## Main Repository Content

- **Main Scripts**:
  - `sequences_to_indexed_spss.py`: Script for sequence indexing.
  - `query_indexed_spss.py`: Script for querying the index.
  - `fmi.py`: Module for handling the FM-index.
  - `timer.py`: Utility module for measuring execution times.

- **Modules**:
  - `pysuffix3/`: Library for building the suffix array (provided).

- **Reports**:
  - `rapports/developer.pdf`: Developer report detailing code structure and key functions.
  - `rapports/scientist.pdf`: Scientific report presenting the context, techniques, and experimental results.

- **Configuration and Workflow**:
  - `config.yaml`: Configuration file.
  - `Snakefile`: Snakemake file for reproducing analyses in the scientific report.

## Pre-requisites

Before installing and using spss_fmindex_project, ensure the following software and libraries are installed:

- **Python 3.7** or a later version.
- **pip**: Python package manager.
- **conda** (optional): For managing virtual environments.

## Installation

### Cloning the Repository

Clone the spss_fmindex_project GitHub repository and access the project directory.

```bash
git clone https://github.com/jalexine/spss_exploration_project.git
cd spss_exploration_project
```

### Environment and Dependencies

The scripts mainly use Python's standard library.

*Note: The `pysuffix3` library is included in the `pysuffix3/` directory and does not need to be installed separately.*

### Installing Snakemake

Snakemake can be installed via `conda` or `pip`.

#### Via Conda

```bash
conda install -c bioconda snakemake
```

#### Via pip

```bash
pip install snakemake
```

## Usage

spss_fmindex_project provides main scripts for indexing DNA sequences and querying the FM index. It also uses Snakemake to reproduce the analyses presented in the scientific report.

### Important Parameters

#### 1. `sequences_to_indexed_spss.py`

- `-i` **(Required)**:  
  FASTA file containing the genomic sequences to index.

- `-t` **(Required)**:  
  Solidity threshold, i.e., the minimum number of occurrences to retain a *k*-mer.

- `-k` **(Required)**:  
  *k*-mer size.

- `-o` **(Optional)**:  
  Output file for the serialized FM index. If not specified, a default path will be generated.

- `-m` **(Optional)**:  
  SPSS construction mode. Can be `simplitig` (default) or `unitig`.
  
- `-stats` **(Optional)**:
  CSV file containing SPSS metrics.


#### 2. `query_indexed_spss.py`

- `-q` **(Required)**:  
  FASTA file containing query sequences to compare against the index.

- `-i` **(Required)**:  
  Serialized FM index file generated by the indexing script.

- `-k` **(Required)**:  
  *k*-mer size.

- `-o` **(Required)**:  
  Output file for similarity results. The format is text, with one line per query sequence indicating the ratio of shared *k*-mers.

### Example Commands

#### 1. Indexing Sequences

Generate the FM index from a FASTA file using the `sequences_to_indexed_spss.py` script.

```bash
python src/sequences_to_indexed_spss.py -i reads_30x.fasta -t 2 -k 31 -o my_fm_index.dump -m simplitig
```

#### 2. Querying the Index

Query the FM index with query sequences using the `query_indexed_spss.py` script.

```bash
python src/query_indexed_spss.py -q queries.fasta -i my_fm_index.dump -k 31 -o res_query.txt
```

#### 3. Displaying Results

Show the query results.

```bash
cat res_query.txt
```

## Input Formats

spss_exploration_project primarily accepts the following file format:

- **FASTA**: For genomic and query sequences.

## Output

spss_exploration_project generates several types of output files:

- **Serialized FM Index** (`.dump`):  
  Contains the FM index generated from the genomic sequences.

- **Similarity Results** (`.txt`):  
  Contains the ratios of shared *k*-mers for each query sequence relative to the index.

- **SPSS (Solid Prefix Sequence Set)**:  
  Optimized data structure used for indexing. Generated internally and used to build the FM index.

- **Benchmarking Results**:  
  Stored in the `benchmark/stats` directory, allowing performance optimization.


## Reproducing Results

To run the complete workflow to reproduce the results in the scientific report, use the following command:



### Requirements

Before starting, ensure your environment is properly configured. You will need:

- **Python** (version 3.6 or higher)  
- **Conda** or a virtual environment to manage dependencies  

To install **Snakemake**, run the following command:  

```bash
conda install -c bioconda -c conda-forge snakemake
```



### Steps

1. **Configure Input Files**:  
   Unzip the file "fastafiles.zip" in  `test-data/` .
      > **Note**: If you want to use your proper fasta files, you need to place them in `teest-data/` and change the name of dataset in the `congif.yaml`. maybe change the rules relatives to the plots. in the same yaml you can change the size of k and t.


3. **Run the Snakemake Workflow**:

```bash
    snakemake --cores 4
```
   > **Note**: You can choose the number of cores to allocate based on your system's resources. Adjust `--cores` to fit your machine's capabilities (e.g., `--cores 8` for a more powerful system).


3. **Verify Results**:  
   The results and analyses will be generated according to the rules defined in the `Snakefile`. Mainly in the `benchmark/` .

## Contributions

The project was developed in pairs by Alexine and Julie. <3

